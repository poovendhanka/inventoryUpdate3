<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/base :: html}">
<head>
    <title>Eyarkkai Family</title>
</head>
<body>
    <!-- Page Title -->
    <th:block id="pageTitle"><h1 class="main-page-title">Eyarkkai Family</h1></th:block>
    
    <!-- Main Content -->
    <div id="content">
        <!-- Success Message -->
        <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
            <span th:text="${successMessage}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        
        <!-- Navigation Tabs -->
        <ul class="nav nav-tabs" id="eyarkkaiTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <a class="nav-link"
                   th:classappend="${currentTab == 'about' || currentTab == null} ? 'active' : ''"
                   th:href="@{/eyarkkai-family(tab='about')}"
                   role="tab">
                    <i class="fas fa-info-circle"></i> About
                </a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link"
                   th:classappend="${currentTab == 'employees'} ? 'active' : ''"
                   th:href="@{/eyarkkai-family(tab='employees', gender='male')}"
                   role="tab">
                    <i class="fas fa-users"></i> Employees
                </a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link"
                   th:classappend="${currentTab == 'connect'} ? 'active' : ''"
                   th:href="@{/eyarkkai-family(tab='connect')}"
                   role="tab">
                    <i class="fas fa-handshake"></i> Connect
                </a>
            </li>
        </ul>
        
        <!-- Tab Content -->
        <div class="tab-content" id="eyarkkaiTabsContent">
            <!-- About Tab -->
            <div class="tab-pane fade" 
                 th:classappend="${currentTab == 'about' || currentTab == null} ? 'show active' : ''"
                 id="about" 
                 role="tabpanel">
                
                <div class="card">
                    <div class="card-header">
                        <h4><i class="fas fa-building"></i> About Eyarkkai Fibers</h4>
                    </div>
                    <div class="card-body">
                        <!-- Directors Section -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="card director-card">
                                    <div class="card-body text-center">
                                        <img src="https://via.placeholder.com/150x150/229954/ffffff?text=Director+1" 
                                             class="rounded-circle mb-3" 
                                             alt="Director 1" 
                                             style="width: 150px; height: 150px;">
                                        <h5 class="card-title">Director Name 1</h5>
                                        <p class="card-text">
                                            <i class="fas fa-phone"></i> +91 9876543210<br>
                                            <i class="fas fa-envelope"></i> director1@eyarkkai.com
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card director-card">
                                    <div class="card-body text-center">
                                        <img src="https://via.placeholder.com/150x150/27ae60/ffffff?text=Director+2" 
                                             class="rounded-circle mb-3" 
                                             alt="Director 2" 
                                             style="width: 150px; height: 150px;">
                                        <h5 class="card-title">Director Name 2</h5>
                                        <p class="card-text">
                                            <i class="fas fa-phone"></i> +91 9876543211<br>
                                            <i class="fas fa-envelope"></i> director2@eyarkkai.com
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- About Section -->
                        <div class="row">
                            <div class="col-12">
                                <h4><i class="fas fa-leaf"></i> About Our Company</h4>
                                <p class="lead">
                                    Eyarkkai Fibers is a leading manufacturer of high-quality coconut fiber products, 
                                    committed to sustainable and eco-friendly production practices.
                                </p>
                                <p>
                                    Founded with a vision to transform coconut husk waste into valuable fiber products, 
                                    we specialize in producing premium coconut fiber, cocopith, and blocks that serve 
                                    various industries including agriculture, horticulture, and manufacturing.
                                </p>
                                <p>
                                    Our state-of-the-art processing facilities and dedicated team ensure that we deliver 
                                    products of the highest quality while maintaining our commitment to environmental 
                                    sustainability and social responsibility.
                                </p>
                                
                                <div class="row mt-4">
                                    <div class="col-md-4">
                                        <div class="text-center">
                                            <h3 class="text-success">10+</h3>
                                            <p>Years of Experience</p>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="text-center">
                                            <h3 class="text-success">500+</h3>
                                            <p>Satisfied Customers</p>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="text-center">
                                            <h3 class="text-success">100%</h3>
                                            <p>Eco-Friendly</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Employees Tab -->
            <div class="tab-pane fade" 
                 th:classappend="${currentTab == 'employees'} ? 'show active' : ''"
                 id="employees" 
                 role="tabpanel">
                
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h4><i class="fas fa-users"></i> Employee Management</h4>
                        <a th:href="@{/eyarkkai-family/employees/add}" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Add Employee
                        </a>
                    </div>
                    <div class="card-body">
                        <!-- Employee Filter Tabs -->
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <!-- Male/Female Filter Buttons - Only show for active employees -->
                            <ul class="nav nav-pills" id="employeeFilterTabs" role="tablist" th:if="${employeeType != 'old'}">
                                <li class="nav-item" role="presentation">
                                    <a class="nav-link" 
                                       th:classappend="${(selectedGender == 'male' || selectedGender == null) && employeeType != 'old'} ? 'active' : ''"
                                       th:href="@{/eyarkkai-family(tab='employees', gender='male')}"
                                       role="tab">
                                        <i class="fas fa-male"></i> Male Employees
                                    </a>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <a class="nav-link" 
                                       th:classappend="${selectedGender == 'female' && employeeType != 'old'} ? 'active' : ''"
                                       th:href="@{/eyarkkai-family(tab='employees', gender='female')}"
                                       role="tab">
                                        <i class="fas fa-female"></i> Female Employees
                                    </a>
                                </li>
                            </ul>
                            
                            <!-- Empty div to maintain layout when Male/Female buttons are hidden -->
                            <div th:if="${employeeType == 'old'}"></div>
                            
                            <!-- Old Employees Button - Always visible -->
                            <div>
                                <a class="btn btn-outline-warning" 
                                   th:classappend="${employeeType == 'old'} ? 'active' : ''"
                                   th:href="@{/eyarkkai-family(tab='employees', employeeType='old', gender=${selectedGender != null ? selectedGender : 'male'})}"
                                   role="button">
                                    <i class="fas fa-user-times"></i> Old Employees
                                </a>
                            </div>
                        </div>
                        
                        <!-- Active Employee List -->
                        <div th:if="${employeeType != 'old'}">
                            <div th:if="${employees != null and !employees.isEmpty()}">
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover">
                                        <thead class="table-success">
                                            <tr>
                                                <th>Name</th>
                                                <th>Contact</th>
                                                <th>Age</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr th:each="employee : ${employees}">
                                                <td th:text="${employee.name}"></td>
                                                <td th:text="${employee.contact}"></td>
                                                <td th:text="${#temporals.year(#temporals.createNow()) - #temporals.year(employee.dateOfBirth)}"></td>
                                                <td>
                                                    <a th:href="@{/eyarkkai-family/employees/{id}(id=${employee.id})}" 
                                                       class="btn btn-sm btn-info me-1">
                                                        <i class="fas fa-eye"></i> View
                                                    </a>
                                                    <a th:href="@{/eyarkkai-family/employees/{id}/edit(id=${employee.id})}" 
                                                       class="btn btn-sm btn-warning me-1">
                                                        <i class="fas fa-edit"></i> Edit
                                                    </a>
                                                    <button type="button"
                                                            class="btn btn-sm btn-danger"
                                                            th:attr="data-employee-id=${employee.id},data-employee-name=${employee.name}"
                                                            onclick="confirmDelete(this)">
                                                        <i class="fas fa-user-times"></i> Delete Employee
                                                    </button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            
                            <div th:if="${employees == null or employees.isEmpty()}" class="text-center py-4">
                                <i class="fas fa-users fa-3x text-muted mb-3"></i>
                                <h5>No active employees found</h5>
                                <p class="text-muted">Start by adding your first employee!</p>
                            </div>
                        </div>
                        
                        <!-- Old Employee List -->
                        <div th:if="${employeeType == 'old'}">
                            <!-- Back to Employees Button -->
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5 class="mb-0"><i class="fas fa-user-times"></i> Old Employees</h5>
                                <a th:href="@{/eyarkkai-family(tab='employees', gender=${selectedGender != null ? selectedGender : 'male'})}" 
                                   class="btn btn-primary">
                                    <i class="fas fa-arrow-left"></i> Back to Employees
                                </a>
                            </div>
                            
                            <!-- Gender Filter for Old Employees -->
                            <ul class="nav nav-pills mb-3" id="oldEmployeeGenderTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <a class="nav-link" 
                                       th:classappend="${selectedGender == 'male' || selectedGender == null} ? 'active' : ''"
                                       th:href="@{/eyarkkai-family(tab='employees', employeeType='old', gender='male')}"
                                       role="tab">
                                        <i class="fas fa-male"></i> Male Old Employees
                                    </a>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <a class="nav-link" 
                                       th:classappend="${selectedGender == 'female'} ? 'active' : ''"
                                       th:href="@{/eyarkkai-family(tab='employees', employeeType='old', gender='female')}"
                                       role="tab">
                                        <i class="fas fa-female"></i> Female Old Employees
                                    </a>
                                </li>
                            </ul>
                            
                            <div th:if="${oldEmployees != null and !oldEmployees.isEmpty()}">
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover">
                                        <thead class="table-warning">
                                            <tr>
                                                <th>Name</th>
                                                <th>Contact</th>
                                                <th>Age</th>
                                                <th>Deleted On</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr th:each="employee : ${oldEmployees}">
                                                <td th:text="${employee.name}"></td>
                                                <td th:text="${employee.contact}"></td>
                                                <td th:text="${#temporals.year(#temporals.createNow()) - #temporals.year(employee.dateOfBirth)}"></td>
                                                <td th:text="${employee.deletedAt != null ? #temporals.format(employee.deletedAt, 'dd-MM-yyyy') : 'N/A'}"></td>
                                                <td>
                                                    <a th:href="@{/eyarkkai-family/old-employees/{id}(id=${employee.id})}" 
                                                       class="btn btn-sm btn-info me-1">
                                                        <i class="fas fa-eye"></i> View
                                                    </a>
                                                    <button type="button"
                                                            class="btn btn-sm btn-success"
                                                            th:attr="data-employee-id=${employee.id},data-employee-name=${employee.name}"
                                                            onclick="confirmRestore(this)">
                                                        <i class="fas fa-undo"></i> Restore
                                                    </button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            
                            <div th:if="${oldEmployees == null or oldEmployees.isEmpty()}" class="text-center py-4">
                                <i class="fas fa-user-times fa-3x text-muted mb-3"></i>
                                <h5>No old employees found</h5>
                                <p class="text-muted">No employees have been deleted yet.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Connect Tab -->
            <div class="tab-pane fade" 
                 th:classappend="${currentTab == 'connect'} ? 'show active' : ''"
                 id="connect" 
                 role="tabpanel">
                
                <div class="card">
                    <div class="card-header">
                        <h4><i class="fas fa-handshake"></i> Connect With Us</h4>
                    </div>
                    <div class="card-body text-center py-5">
                        <i class="fas fa-construction fa-4x text-muted mb-4"></i>
                        <h3>Coming Soon</h3>
                        <p class="text-muted">This section is under development. Check back later for updates!</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Delete Confirmation Modal -->
        <div class="modal fade" id="deleteModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Confirm Delete Employee</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <p>Are you sure you want to move employee <strong id="employeeName"></strong> to old employees?</p>
                        <p class="text-warning">The employee will be moved to the "Old Employees" section and can be restored later.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <form id="deleteForm" method="post" style="display: inline;">
                            <button type="submit" class="btn btn-danger">Delete Employee</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Restore Confirmation Modal -->
        <div class="modal fade" id="restoreModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Confirm Restore</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <p>Are you sure you want to restore employee <strong id="restoreEmployeeName"></strong>?</p>
                        <p class="text-success">The employee will be moved back to the active employees list.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <form id="restoreForm" method="post" style="display: inline;">
                            <button type="submit" class="btn btn-success">Restore Employee</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Page specific scripts -->
    <th:block id="pagescript">
        <script>
            // Wait for DOM to be fully loaded
            document.addEventListener('DOMContentLoaded', function() {
                console.log('DOM loaded, Bootstrap version:', bootstrap.Modal ? 'Available' : 'Not Available');
                
                // Check if modal elements exist on page load
                var deleteModal = document.getElementById('deleteModal');
                var restoreModal = document.getElementById('restoreModal');
                var employeeName = document.getElementById('employeeName');
                var deleteForm = document.getElementById('deleteForm');
                
                console.log('Modal elements on page load:');
                console.log('deleteModal:', deleteModal);
                console.log('restoreModal:', restoreModal);
                console.log('employeeName:', employeeName);
                console.log('deleteForm:', deleteForm);
            });
            
            function confirmDelete(button) {
                try {
                    console.log('confirmDelete called');
                    var employeeId = button.getAttribute('data-employee-id');
                    var employeeName = button.getAttribute('data-employee-name');
                    console.log('Employee ID:', employeeId, 'Name:', employeeName);
                    
                    if (!employeeId || !employeeName) {
                        console.error('Missing employee data');
                        alert('Error: Missing employee information');
                        return;
                    }
                    
                    var nameElement = document.getElementById('employeeName');
                    var formElement = document.getElementById('deleteForm');
                    var modalElement = document.getElementById('deleteModal');
                    
                    console.log('Modal elements check:');
                    console.log('nameElement:', nameElement);
                    console.log('formElement:', formElement);
                    console.log('modalElement:', modalElement);
                    
                    if (!nameElement) {
                        console.error('employeeName element not found');
                        alert('Error: employeeName element not found');
                        return;
                    }
                    if (!formElement) {
                        console.error('deleteForm element not found');
                        alert('Error: deleteForm element not found');
                        return;
                    }
                    if (!modalElement) {
                        console.error('deleteModal element not found');
                        alert('Error: deleteModal element not found');
                        return;
                    }
                    
                    nameElement.textContent = employeeName;
                    formElement.action = '/eyarkkai-family/employees/' + employeeId + '/delete';
                    
                    console.log('Form action set to:', formElement.action);
                    
                    var modal = new bootstrap.Modal(modalElement);
                    modal.show();
                    console.log('Modal should be shown');
                } catch (error) {
                    console.error('Error in confirmDelete:', error);
                    alert('Error: ' + error.message);
                }
            }
            
            function confirmRestore(button) {
                try {
                    console.log('confirmRestore called');
                    var employeeId = button.getAttribute('data-employee-id');
                    var employeeName = button.getAttribute('data-employee-name');
                    console.log('Employee ID:', employeeId, 'Name:', employeeName);
                    
                    if (!employeeId || !employeeName) {
                        console.error('Missing employee data');
                        alert('Error: Missing employee information');
                        return;
                    }
                    
                    var nameElement = document.getElementById('restoreEmployeeName');
                    var formElement = document.getElementById('restoreForm');
                    var modalElement = document.getElementById('restoreModal');
                    
                    if (!nameElement || !formElement || !modalElement) {
                        console.error('Missing modal elements');
                        alert('Error: Modal elements not found');
                        return;
                    }
                    
                    nameElement.textContent = employeeName;
                    formElement.action = '/eyarkkai-family/old-employees/' + employeeId + '/restore';
                    
                    console.log('Form action set to:', formElement.action);
                    
                    var modal = new bootstrap.Modal(modalElement);
                    modal.show();
                    console.log('Modal should be shown');
                } catch (error) {
                    console.error('Error in confirmRestore:', error);
                    alert('Error: ' + error.message);
                }
            }
        </script>
        
        <style>
            .director-card {
                box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
                border: 1px solid #229954;
            }
            
            .director-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
                transition: all 0.3s ease;
            }
            
            .btn-outline-warning.active {
                background-color: #ffc107;
                border-color: #ffc107;
                color: #000;
            }
        </style>
    </th:block>
</body>
</html> 